<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Your Memory - Happy Owl</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&family=Pacifico&display=swap');

        :root {
            --primary: #f72585; /* ‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå JFF CORP's */
            --soft: #fff5f7;
            --white: #ffffff;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--soft);
            margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; padding-bottom: 40px;
        }

        .header { margin-top: 30px; text-align: center; }
        .header h1 { font-family: 'Pacifico', cursive; color: var(--primary); font-size: 2.2rem; margin: 0; }

        /* --- Photo Card --- */
        .photo-card {
            background: var(--white); padding: 12px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(247, 37, 133, 0.1);
            width: 85%; max-width: 400px; margin-top: 25px;
            box-sizing: border-box;
        }
        .photo-card img { width: 100%; border-radius: 12px; display: block; }

        .tip-text { font-size: 0.8rem; color: #999; margin-top: 15px; }

        /* --- Action Buttons --- */
        .btn-container {
            width: 85%; max-width: 400px; margin-top: 25px;
            display: flex; flex-direction: column; gap: 15px;
        }

        .btn {
            padding: 16px; border-radius: 50px; border: none;
            font-family: 'Kanit'; font-weight: 600; font-size: 1.1rem;
            cursor: pointer; transition: 0.3s; text-decoration: none;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }

        .btn-share {
            background: var(--primary); color: var(--white);
            box-shadow: 0 8px 20px rgba(247, 37, 133, 0.2);
        }

        .btn-save {
            background: var(--white); color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn:active { transform: scale(0.95); opacity: 0.9; }

        /* Floating Hearts */
        .heart { position: fixed; color: var(--primary); opacity: 0.2; z-index: -1; animation: floatUp 15s infinite linear; }
        @keyframes floatUp {
            from { transform: translateY(110vh) rotate(0deg); }
            to { transform: translateY(-10vh) rotate(360deg); }
        }

        /* Loading Overlay */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.8); z-index: 100;
            display: none; align-items: center; justify-content: center;
            font-weight: 600; color: var(--primary);
        }
    </style>
</head>
<body>

<div id="loader">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ä‡∏£‡πå...</div>

<div class="header">
    <h1>Happy Owl ü¶â</h1>
    <div style="color: #666; font-size: 0.9rem;">Your Valentine's Memory</div>
</div>

<div class="photo-card">
    <img id="displayImg" src="" alt="Loading Photo...">
</div>

<p class="tip-text">üí° ‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏∑‡πà‡∏≠ "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á"</p>

<div class="btn-container">
    <button class="btn btn-share" onclick="handleShare()">
        <span>üì§</span> ‡πÅ‡∏ä‡∏£‡πå‡∏•‡∏á Story / ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô
    </button>
    
    <a href="index.html" class="btn btn-save">
        <span>üì∏</span> ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
    </a>
</div>

<div style="margin-top: 40px; color: #ccc; font-size: 0.7rem;">Powered by JFF CORP's</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const photoUrl = urlParams.get('url');
    const displayImg = document.getElementById('displayImg');
    const loader = document.getElementById('loader');

    window.onload = () => {
        if (photoUrl) {
            displayImg.src = photoUrl;
        } else {
            alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û!");
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏•‡∏≠‡∏¢‡πÜ
        for(let i=0; i<8; i++) {
            const h = document.createElement('div');
            h.className = 'heart'; h.innerHTML = '‚ù§Ô∏è';
            h.style.left = Math.random() * 100 + 'vw';
            h.style.fontSize = (15 + Math.random() * 20) + 'px';
            h.style.animationDelay = (Math.random() * 10) + 's';
            document.body.appendChild(h);
        }
    };

    async function handleShare() {
        if (!photoUrl) return;
        
        loader.style.display = 'flex';
        
        try {
            // 1. ‡∏î‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å URL ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô Blob
            const response = await fetch(photoUrl);
            const blob = await response.blob();
            
            // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå File Object
            const file = new File([blob], 'happy-owl.png', { type: 'image/png' });

            // 3. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Web Share API ‡πÅ‡∏ö‡∏ö‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå
            if (navigator.canShare && navigator.canShare({ files: [file] })) {
                await navigator.share({
                    files: [file],
                    title: 'Happy Owl Moment ü¶âüíñ',
                    text: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡∏à‡∏≤‡∏Å‡∏ï‡∏π‡πâ Happy Owl!'
                });
            } else {
                // Fallback: ‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏´‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå
                await navigator.share({
                    title: 'Happy Owl Moment ü¶âüíñ',
                    url: photoUrl
                });
            }
        } catch (err) {
            console.error('Share Error:', err);
            // Fallback ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå
            navigator.clipboard.writeText(photoUrl);
            alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß! ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö");
        } finally {
            loader.style.display = 'none';
        }
    }
</script>
</body>
</html>
