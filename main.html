<!DOCTYPE html>
<html lang="th">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>AI Event : AI Event : Owl Always Love You - Memory Wall</title>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
Â  Â  <style>
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&family=Pacifico&display=swap');

Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --bg-pink: #fff0f3;
Â  Â  Â  Â  Â  Â  --paper-white: #ffffff;
Â  Â  Â  Â  Â  Â  --accent-pink: #ff4d6d;
Â  Â  Â  Â  Â  Â  --dark-pink: #f72585;
Â  Â  Â  Â  Â  Â  --soft-pink: #ffb3c1;
Â  Â  Â  Â  Â  Â  --glass: rgba(255, 255, 255, 0.6);
Â  Â  Â  Â  }

Â  Â  Â  Â  body, html {
Â  Â  Â  Â  Â  Â  margin: 0; padding: 0;
Â  Â  Â  Â  Â  Â  width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  background-color: var(--bg-pink);
Â  Â  Â  Â  Â  Â  background-image: radial-gradient(var(--soft-pink) 1px, transparent 1px);
Â  Â  Â  Â  Â  Â  background-size: 30px 30px; /* à¸¥à¸”à¸‚à¸™à¸²à¸”à¸ˆà¸¸à¸” background */
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  font-family: 'Kanit', sans-serif;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Header Section (Compact Scale) --- */
Â  Â  Â  Â  .main-header {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  padding: 20px 10px 15px; /* à¸¥à¸” Padding */
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  Â  Â  Â  background: linear-gradient(to bottom, var(--bg-pink) 70%, transparent);
Â  Â  Â  Â  }

Â  Â  Â  Â  .main-header h1 {
Â  Â  Â  Â  Â  Â  font-family: 'Pacifico', cursive;
Â  Â  Â  Â  Â  Â  font-size: 3rem; /* à¸¥à¸”à¸‚à¸™à¸²à¸”à¸ˆà¸²à¸ 4.5rem */
Â  Â  Â  Â  Â  Â  color: var(--dark-pink);
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  text-shadow: 2px 2px 8px rgba(247, 37, 133, 0.2);
Â  Â  Â  Â  Â  Â  line-height: 1.1;
Â  Â  Â  Â  }

Â  Â  Â  Â  .main-header p {
Â  Â  Â  Â  Â  Â  font-size: 1.1rem; /* à¸¥à¸”à¸‚à¸™à¸²à¸”à¸ˆà¸²à¸ 1.5rem */
Â  Â  Â  Â  Â  Â  color: #666;
Â  Â  Â  Â  Â  Â  margin: 5px 0 0;
Â  Â  Â  Â  Â  Â  font-weight: 300;
Â  Â  Â  Â  Â  Â  letter-spacing: 1px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- LOGO à¸¡à¸¸à¸¡à¸‚à¸§à¸²à¸šà¸™ (Scaled Down) --- */
Â  Â  Â  Â  .brand-logo-fixed {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 15px;
Â  Â  Â  Â  Â  Â  right: 20px;
Â  Â  Â  Â  Â  Â  z-index: 1100;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .brand-logo-fixed img {
Â  Â  Â  Â  Â  Â  height: 60px; /* à¸¥à¸”à¸‚à¸™à¸²à¸”à¸ˆà¸²à¸ 90px */
Â  Â  Â  Â  Â  Â  width: auto;
Â  Â  Â  Â  Â  Â  opacity: 0.9;
Â  Â  Â  Â  Â  Â  filter: drop-shadow(0 3px 10px rgba(0,0,0,0.1));
Â  Â  Â  Â  }

Â  Â  Â  Â  #wall {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  z-index: 1;
Â  Â  Â  Â  Â  Â  perspective: 1200px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .floating-heart-bg {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  color: var(--soft-pink);
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  Â  Â  top: -10vh;
Â  Â  Â  Â  Â  Â  animation: floatDown var(--d) linear infinite;
Â  Â  Â  Â  Â  Â  z-index: 0;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes floatDown {
Â  Â  Â  Â  Â  Â  0% { transform: translateY(0) scale(0.4) rotate(0deg); opacity: 0; }
Â  Â  Â  Â  Â  Â  10% { opacity: 0.5; }
Â  Â  Â  Â  Â  Â  90% { opacity: 0.5; }
Â  Â  Â  Â  Â  Â  100% { transform: translateY(110vh) scale(1) rotate(360deg); opacity: 0; }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Footer Section (Compact Scale) --- */
Â  Â  Â  Â  .footer-bar {
Â  Â  Â  Â  Â  Â  height: 120px; /* à¸¥à¸”à¸ˆà¸²à¸ 180px */
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.4);
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  Â  Â  Â  -webkit-backdrop-filter: blur(10px);
Â  Â  Â  Â  Â  Â  display: flex; justify-content: center; align-items: center;
Â  Â  Â  Â  Â  Â  border-top: 1px solid rgba(255, 255, 255, 0.5);
Â  Â  Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-start {
Â  Â  Â  Â  Â  Â  padding: 15px 50px; /* à¸¥à¸”à¸ˆà¸²à¸ 25/90 */
Â  Â  Â  Â  Â  Â  font-size: 22px; /* à¸¥à¸”à¸ˆà¸²à¸ 36px */
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  background: linear-gradient(45deg, var(--dark-pink), var(--accent-pink));
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 50px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 25px rgba(247, 37, 133, 0.2);
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  Â  Â  font-family: 'Kanit', sans-serif;
Â  Â  Â  Â  Â  Â  text-decoration: none;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-start:hover { transform: scale(1.05); }

Â  Â  Â  Â  /* --- Photo Items (Downscaled) --- */
Â  Â  Â  Â  .photo-item {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  background: var(--paper-white);
Â  Â  Â  Â  Â  Â  padding: 8px 8px 25px 8px; /* à¸¥à¸” padding */
Â  Â  Â  Â  Â  Â  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
Â  Â  Â  Â  Â  Â  transition: all 1s ease-out;
Â  Â  Â  Â  Â  Â  transform-origin: top center;
Â  Â  Â  Â  Â  Â  animation: windSway var(--sway-dur) ease-in-out infinite alternate var(--sway-delay);
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  z-index: 5;
Â  Â  Â  Â  Â  Â  border-radius: 3px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .photo-item.visible { opacity: 1; }
Â  Â  Â  Â  .p-grid4 { width: 140px; height: 200px; } /* à¸¥à¸”à¸‚à¸™à¸²à¸”à¸ˆà¸²à¸ 180x260 */

Â  Â  Â  Â  @keyframes windSway {
Â  Â  Â  Â  Â  Â  0%Â  Â { transform: rotate(calc(var(--r) - 2deg)); }
Â  Â  Â  Â  Â  Â  100% { transform: rotate(calc(var(--r) + 2deg)); }
Â  Â  Â  Â  }

Â  Â  Â  Â  .photo-item::before {
Â  Â  Â  Â  Â  Â  content: "";
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: -12px; left: 50%;
Â  Â  Â  Â  Â  Â  transform: translateX(-50%) rotate(var(--tape-r));
Â  Â  Â  Â  Â  Â  width: 40px; height: 18px; /* à¸¥à¸”à¸‚à¸™à¸²à¸”à¹€à¸—à¸› */
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.4);
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(2px);
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255,255,255,0.3);
Â  Â  Â  Â  }

Â  Â  Â  Â  .photo-item img {Â 
Â  Â  Â  Â  Â  Â  width: 100%; height: 100%;Â 
Â  Â  Â  Â  Â  Â  object-fit: cover;
Â  Â  Â  Â  Â  Â  display: block;Â 
Â  Â  Â  Â  Â  Â  background: #fafafa;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .loading-text {
Â  Â  Â  Â  Â  Â  position: absolute; width: 100%; top: 40%; text-align: center;
Â  Â  Â  Â  Â  Â  color: var(--dark-pink); font-size: 1.4rem; font-family: 'Pacifico';
Â  Â  Â  Â  Â  Â  opacity: 0.5;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

<div class="brand-logo-fixed">
Â  Â  <img src="assets/Logo.png" alt="Logo">
</div>

<div class="main-header">
Â  Â  <h1>AI Event : Owl Always Love You</h1>
Â  Â  <p>à¸£à¹ˆà¸§à¸¡à¹€à¸à¹‡à¸šà¸„à¸§à¸²à¸¡à¸—à¸£à¸‡à¸ˆà¸³à¸”à¸µà¸”à¸µà¸”à¹‰à¸§à¸¢à¸à¸±à¸™</p>
</div>

<div id="wall">
Â  Â  <div class="loading-text" id="loading">Gathering memories...</div>
</div>

<div class="footer-bar">
Â  Â  <a href="layout.html" class="btn-start">
Â  Â  Â  Â  <span>ğŸ“¸</span> à¹€à¸£à¸´à¹ˆà¸¡à¸–à¹ˆà¸²à¸¢à¸£à¸¹à¸›
Â  Â  </a>
</div>

<script>
    const supabaseUrl = 'https://mhdlmwscndyyokvcqqla.supabase.co';
    const supabaseKey = 'sb_publishable_fr1iDj6c6_lWS7bHQF3d4w_D6VoatP4';
    const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);

    const wall = document.getElementById('wall');
    const cols = 6;
    const rows = 3;
    const maxOnScreen = cols * rows; // 18 à¸£à¸¹à¸›
    
    let gridSlots = [];
    let photoPool = []; // à¹€à¸à¹‡à¸šà¸£à¸¹à¸›à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸—à¸µà¹ˆà¸”à¸¶à¸‡à¸¡à¸²
    let activePhotos = new Map(); // à¹€à¸à¹‡à¸šà¸§à¹ˆà¸² Slot à¹„à¸«à¸™à¹‚à¸Šà¸§à¹Œà¸£à¸¹à¸› ID à¸­à¸°à¹„à¸£à¸­à¸¢à¸¹à¹ˆ

    function initGrid() {
        gridSlots = [];
        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                gridSlots.push({ r, c, index: r * cols + c });
            }
        }
        gridSlots.sort(() => Math.random() - 0.5);
    }

    function placePhotoOnWall(photo, slot, isNew = false) {
        if (!photo || !slot) return;
        
        // à¸¥à¸šà¸£à¸¹à¸›à¹€à¸à¹ˆà¸²à¹ƒà¸™ Slot à¸™à¸±à¹‰à¸™à¸­à¸­à¸à¸à¹ˆà¸­à¸™ (à¸–à¹‰à¸²à¸¡à¸µ)
        const oldItem = document.querySelector(`.slot-${slot.index}`);
        if (oldItem) {
            oldItem.classList.remove('visible');
            setTimeout(() => oldItem.remove(), 1000);
        }

        const item = document.createElement('div');
        item.className = `photo-item p-grid4 slot-${slot.index}`;

        const cellW = window.innerWidth / cols;
        const cellH = (window.innerHeight - 200) / rows;
        const offsetX = (Math.random() - 0.5) * (cellW * 0.4);
        const offsetY = (Math.random() - 0.5) * (cellH * 0.4);
        const rotate = (Math.random() - 0.5) * 15;
        const tapeRotate = (Math.random() - 0.5) * 30;

        item.style.left = `${(slot.c * cellW) + (cellW/2) + offsetX - 70}px`;
        item.style.top = `${(slot.r * cellH) + (cellH/2) + offsetY - 100}px`;
        item.style.setProperty('--r', `${rotate}deg`);
        item.style.setProperty('--tape-r', `${tapeRotate}deg`);
        item.style.setProperty('--sway-dur', (4 + Math.random() * 4) + 's');
        item.style.setProperty('--sway-delay', -(Math.random() * 5) + 's');
        
        item.innerHTML = `<img src="${photo.preview_url}" alt="Memory">`;
        wall.appendChild(item);
        
        // à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¹ˆà¸² Slot à¸™à¸µà¹‰à¸à¸³à¸¥à¸±à¸‡à¹‚à¸Šà¸§à¹Œà¸£à¸¹à¸›à¹ƒà¸šà¸™à¸µà¹‰
        activePhotos.set(slot.index, photo.preview_url);

        setTimeout(() => { item.classList.add('visible'); }, isNew ? 100 : 300);
    }

    async function fetchPhotos() {
        initGrid();
        // à¸”à¸¶à¸‡à¸¡à¸²à¹€à¸¢à¸­à¸°à¸«à¸™à¹ˆà¸­à¸¢ à¹€à¸Šà¹ˆà¸™ 60 à¸£à¸¹à¸›à¹€à¸à¸·à¹ˆà¸­à¹€à¸­à¸²à¸¡à¸²à¸§à¸™à¸¥à¸¹à¸›
        const { data: photos, error } = await supabaseClient
            .from('photos')
            .select('preview_url')
            .eq('is_active', true)
            .order('created_at', { ascending: false })
            .limit(60); 

        document.getElementById('loading').style.display = 'none';

        if (photos && photos.length > 0) {
            photoPool = photos;
            
            // à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™: à¸§à¸²à¸‡à¸£à¸¹à¸›à¹ƒà¸«à¹‰à¹€à¸•à¹‡à¸¡ Grid (à¹„à¸¡à¹ˆà¹€à¸à¸´à¸™à¸ˆà¸³à¸™à¸§à¸™à¸£à¸¹à¸›à¸—à¸µà¹ˆà¸¡à¸µ)
            const initialCount = Math.min(photos.length, maxOnScreen);
            for (let i = 0; i < initialCount; i++) {
                placePhotoOnWall(photoPool[i], gridSlots[i]);
            }

            // à¸–à¹‰à¸²à¸¡à¸µà¸£à¸¹à¸›à¹ƒà¸™ Pool à¸¡à¸²à¸à¸à¸§à¹ˆà¸²à¸—à¸µà¹ˆà¹‚à¸Šà¸§à¹Œà¸šà¸™à¸ˆà¸­ à¹ƒà¸«à¹‰à¹€à¸£à¸´à¹ˆà¸¡à¸§à¸™à¸¥à¸¹à¸›
            if (photoPool.length > maxOnScreen) {
                startCycling();
            }
        }
    }

    function startCycling() {
        // à¸—à¸¸à¸à¹† 5 à¸§à¸´à¸™à¸²à¸—à¸µ à¸ªà¸¸à¹ˆà¸¡à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ 1 à¸£à¸¹à¸›
        setInterval(() => {
            // 1. à¸ªà¸¸à¹ˆà¸¡à¹€à¸¥à¸·à¸­à¸ Slot à¸—à¸µà¹ˆà¸ˆà¸°à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™
            const randomSlotIndex = Math.floor(Math.random() * maxOnScreen);
            const slot = gridSlots.find(s => s.index === randomSlotIndex);
            
            // 2. à¸ªà¸¸à¹ˆà¸¡à¸«à¸²à¸£à¸¹à¸›à¸ˆà¸²à¸ Pool à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹‚à¸Šà¸§à¹Œà¸­à¸¢à¸¹à¹ˆà¸šà¸™à¸ˆà¸­
            const currentOnScreen = Array.from(activePhotos.values());
            const availablePhotos = photoPool.filter(p => !currentOnScreen.includes(p.preview_url));
            
            if (availablePhotos.length > 0) {
                const nextPhoto = availablePhotos[Math.floor(Math.random() * availablePhotos.length)];
                placePhotoOnWall(nextPhoto, slot);
            }
        }, 5000); // à¸›à¸£à¸±à¸šà¹€à¸§à¸¥à¸²à¸•à¸£à¸‡à¸™à¸µà¹‰ (5000 = 5 à¸§à¸´à¸™à¸²à¸—à¸µ)
    }

    function subscribeToNewPhotos() {
        supabaseClient
            .channel('public:photos')
            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'photos' }, payload => {
                if (payload.new.preview_url && payload.new.is_active) {
                    // à¹€à¸à¸´à¹ˆà¸¡à¸£à¸¹à¸›à¹ƒà¸«à¸¡à¹ˆà¹€à¸‚à¹‰à¸² Pool (à¹„à¸§à¹‰à¸šà¸™à¸ªà¸¸à¸”)
                    photoPool.unshift(payload.new);
                    // à¸ªà¸¸à¹ˆà¸¡à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ Slot à¸«à¸™à¸¶à¹ˆà¸‡à¸—à¸±à¸™à¸—à¸µà¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸£à¸¹à¸›à¹ƒà¸«à¸¡à¹ˆà¸‚à¸¶à¹‰à¸™à¹‚à¸Šà¸§à¹Œ
                    const randomSlot = gridSlots[Math.floor(Math.random() * gridSlots.length)];
                    placePhotoOnWall(payload.new, randomSlot, true);
                }
            })
            .subscribe();
    }

    window.onload = () => {
        fetchPhotos();
        subscribeToNewPhotos();
        
        // Heart Animation
        setInterval(() => {
            const heart = document.createElement('div');
            heart.className = 'floating-heart-bg';
            heart.innerHTML = ['â¤ï¸', 'ğŸ’–', 'âœ¨'][Math.floor(Math.random() * 3)];
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.setProperty('--d', (10 + Math.random() * 10) + 's');
            wall.appendChild(heart);
            setTimeout(() => heart.remove(), 20000);
        }, 1200);
    };
</script>

</body>
</html>
