<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Share Test - Happy Owl</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&family=Pacifico&display=swap');
        :root { --primary: #f72585; --bg: #fff5f7; }
        body { font-family: 'Kanit', sans-serif; background-color: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }
        .test-card { background: white; padding: 25px; border-radius: 30px; box-shadow: 0 15px 35px rgba(247, 37, 133, 0.15); text-align: center; max-width: 400px; width: 100%; box-sizing: border-box; }
        h1 { font-family: 'Pacifico', cursive; color: var(--primary); margin: 0 0 10px; }
        .mock-img-wrap { width: 100%; border-radius: 15px; overflow: hidden; border: 2px solid var(--bg); margin-bottom: 20px; }
        .mock-img-wrap img { width: 100%; display: block; }
        .btn-share { background: var(--primary); color: white; border: none; padding: 16px; border-radius: 50px; font-family: 'Kanit'; font-weight: 600; font-size: 1.1rem; cursor: pointer; width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.3s; }
        .btn-share:disabled { background: #ccc; cursor: not-allowed; }
        .status-msg { margin-top: 15px; font-size: 0.85rem; color: #888; font-weight: 400; }
    </style>
</head>
<body>

<div class="test-card">
    <h1>Story Test ü¶â</h1>
    <p style="color: #666; margin-bottom: 20px;">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏ä‡∏£‡πå "‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á Story</p>
    
    <div class="mock-img-wrap">
        <img id="testImg" src="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=640&h=853&auto=format&fit=crop" alt="Test Image">
    </div>

    <button id="shareBtn" class="btn-share" onclick="testShareFile()">
        <span>üì∏</span> ‡πÅ‡∏ä‡∏£‡πå‡∏•‡∏á Instagram Story
    </button>

    <div id="msg" class="status-msg">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô‡∏ö‡∏ô HTTPS ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)</div>
</div>

<script>
    // ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πâ‡∏≤‡∏°‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡πÑ‡∏î‡πâ (CORS)
    const mockPhotoUrl = "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=640&h=853&auto=format&fit=crop";

    async function testShareFile() {
        const msg = document.getElementById('msg');
        const btn = document.getElementById('shareBtn');
        
        btn.disabled = true;
        msg.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û...";

        try {
            // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Blob
            const response = await fetch(mockPhotoUrl);
            const blob = await response.blob();
            
            // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå Object ‡∏à‡∏≤‡∏Å Blob
            const file = new File([blob], 'happy-owl-capture.png', { type: 'image/png' });

            // 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏ü‡∏•‡πå
            if (navigator.canShare && navigator.canShare({ files: [file] })) {
                msg.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö...";
                await navigator.share({
                    files: [file], // ‡∏™‡πà‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ
                    title: 'Happy Owl Moment ü¶âüíñ',
                    text: '‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏™‡∏ô‡∏∏‡∏Å‡πÜ ‡∏à‡∏≤‡∏Å‡∏ï‡∏π‡πâ Happy Owl!'
                });
                msg.innerText = "‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!";
            } else {
                throw new Error("Browser ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏ü‡∏•‡πå");
            }
        } catch (err) {
            console.error('Share failed:', err);
            msg.innerText = "‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: " + err.message;
            
            // Fallback: ‡∏ñ‡πâ‡∏≤‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡πÅ‡∏ä‡∏£‡πå‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏ó‡∏ô
            try {
                await navigator.share({
                    title: 'Happy Owl Moment ü¶âüíñ',
                    url: mockPhotoUrl
                });
            } catch (linkErr) {
                navigator.clipboard.writeText(mockPhotoUrl);
                alert("Browser ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏ö‡∏ö Native ‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö");
            }
        } finally {
            btn.disabled = false;
        }
    }
</script>

</body>
</html>
